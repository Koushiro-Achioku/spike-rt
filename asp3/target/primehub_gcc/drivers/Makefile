#  SPDX-License-Identifier: MIT
#
#  Makefile for driver API.
#
#  Copyright (C) 2022 by Embedded and Real-Time Systems Laboratory,
#                        Graduate School of Information Science, Nagoya Univ., JAPAN
#

#
#  Definition for Newlib.
#
SYSSVC_COBJS += newlib_stub.o

#
#  Definitions for Pybricks Task.
#
KERNEL_DIRS += $(TARGETDIR)/drivers

#
#  Definitions for Pybricks-C.
#
KERNEL_DIRS += $(TARGETDIR)/drivers/pybricks-c \
							 $(TARGETDIR)/drivers/pybricks-c/common
KERNEL_COBJS += pb_type_motor.o pb_type_dcmotor.o

#
#  Definitions for SPIKE API.
#
KERNEL_DIRS += $(TARGETDIR)/drivers/spike \
							 $(TARGETDIR)/drivers/spike/hub \
							 $(TARGETDIR)/drivers/spike/pup

KERNEL_COBJS += light.o display.o display_fonts.o button.o battery.o
KERNEL_COBJS += pup_device.o ultrasonicsensor.o colorsensor.o forcesensor.o motor.o

INCLUDES += -I$(TARGETDIR)/drivers \
						-I$(TARGETDIR)/drivers/spike \

#
#  Definitions for Pybricks.
#
ifdef KERNEL_LIB
	PYBRICKS_OBJDIR ?= $(KERNEL_LIB)/../obj-primehub_pybricks
else
	PYBRICKS_OBJDIR ?= ../obj-primehub_pybricks
endif

include $(EXTERNAL_DIR)/pybricks.mk

INCLUDES +=  $(PYBRICKS_INCLUDES)
LIBS += $(PYBRICKS_LIB)

#
#  pybricks.c has to be compiled after TOPPERS configurator (asp3/cfg/cfg.rb) has executed
#  because it depends on kernel_cfg.h generated by the configurator.
#  So include pybricks.o in SYSSVC_COBJS not KERNEL_COBJS,
#  so that pybricks.c is compiled while application building.
#
SYSSVC_COBJS += pybricks.o
